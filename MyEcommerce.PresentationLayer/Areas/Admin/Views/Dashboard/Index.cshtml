@using Utilities
@model DashboardViewModel
@{
    ViewBag.PageTitle = "Admin Area";
    ViewBag.CardTitle = "Dashboard";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<style>
    body {
        background: #f0f2f7;
        font-family: 'Roboto', sans-serif;
        transition: background 0.3s, color 0.3s;
    }

    /* ========= TOP NAV ========= */
    .top-nav-buttons {
        margin-bottom: -20px;
    }

    .btn-nav {
        border-radius: 12px;
        padding: 10px 20px;
        font-weight: 600;
        transition: 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* ========= KPI CARDS ========= */
    .kpi-card {
        height: 180px;
        border-radius: 16px;
        padding: 20px;
        color: #fff;
        position: relative;
        overflow: hidden;
        transition: .3s;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

        .kpi-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 14px 30px rgba(0,0,0,.15);
        }

    .kpi-value {
        font-size: 2.4rem;
        font-weight: 700;
    }

    .kpi-label {
        font-size: 1rem;
        opacity: .9;
    }

    .kpi-icon {
        position: absolute;
        right: 15px;
        top: 15px;
        font-size: 60px;
        opacity: .25;
    }

    /* ========= STATUS & INFO CARDS ========= */
    .status-card, .info-card {
        background: #fff;
        height: 180px;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 6px 18px rgba(0,0,0,.08);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transition: .3s;
    }

        .status-card:hover, .info-card:hover {
            transform: translateY(-6px);
        }

    .status-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .status-value {
        font-size: 1.9rem;
        font-weight: 700;
    }

    .status-label, .info-title {
        color: #666;
    }

    .status-icon, .info-icon {
        font-size: 32px;
        opacity: .85;
    }

    /* ========= PROGRESS ========= */
    .progress {
        height: 6px;
        border-radius: 6px;
        background: #e5e7eb;
        overflow: hidden;
        margin-top: 10px;
    }

    .progress-bar {
        height: 100%;
        border-radius: 6px;
        transition: width .6s ease;
    }

    .progress-approved {
        background: linear-gradient(135deg,#22c55e,#16a34a);
    }

    .progress-shipped {
        background: linear-gradient(135deg,#3b82f6,#2563eb);
    }

    .progress-pending {
        background: linear-gradient(135deg,#f59e0b,#d97706);
    }

    .progress-locked {
        background: linear-gradient(135deg,#ef4444,#b91c1c);
    }

    .small-box-footer {
        text-decoration: none;
        font-weight: 500;
        color: #555;
        font-size: 0.9rem;
    }

        .small-box-footer:hover {
            color: #000;
        }

    /* ========= COLORS ========= */
    .bg-products {
        background: linear-gradient(135deg,#60A5FA,#2563EB);
    }

    .bg-orders {
        background: linear-gradient(135deg,#34D399,#059669);
    }

    .bg-users {
        background: linear-gradient(135deg,#FBBF24,#F59E0B);
    }

    .bg-categories {
        background: linear-gradient(135deg,#A78BFA,#7C3AED);
    }

    /* ========= DARK MODE ========= */
    body.dark-mode {
        background: #0f172a;
        color: #e5e7eb;
    }

        body.dark-mode .status-card, body.dark-mode .info-card {
            background: #1e293b;
            box-shadow: none;
        }

        body.dark-mode .status-label, body.dark-mode .info-title, body.dark-mode .small-box-footer {
            color: #cbd5e1;
        }

            body.dark-mode .small-box-footer:hover {
                color: #fff;
            }

        body.dark-mode .progress {
            background: #334155;
        }

        body.dark-mode .btn-outline-dark {
            border-color: #475569;
            color: #e2e8f0;
        }
</style>

<div class="container py-4">
    <div class="row mb-5 top-nav-buttons">
        <div class="col-12 d-flex justify-content-between align-items-center">
            <a href="/" class="btn btn-outline-primary btn-nav shadow-sm">
                <i class="bi bi-house-door"></i> Back to Store
            </a>
            <button id="themeToggle" class="btn btn-outline-dark btn-nav shadow-sm">
                <span id="themeIcon">ðŸŒ™</span> <span id="themeText">Dark Mode</span>
            </button>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-3 col-md-6">
            <div class="kpi-card bg-categories">
                <div>
                    <div class="kpi-value">@Model.TotalCategories</div>
                    <div class="kpi-label">Categories</div>
                </div>
                <i class="ion ion-grid kpi-icon"></i>
                <a href="/Admin/Category/Index" class="small-box-footer text-white">More info â†’</a>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="kpi-card bg-products">
                <div>
                    <div class="kpi-value">@Model.TotalProducts</div>
                    <div class="kpi-label">Products</div>
                </div>
                <i class="ion ion-bag kpi-icon"></i>
                <a href="/Admin/Product/Index" class="small-box-footer text-white">More info â†’</a>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="kpi-card bg-orders">
                <div>
                    <div class="kpi-value">@Model.TotalOrders</div>
                    <div class="kpi-label">Orders</div>
                </div>
                <i class="ion ion-stats-bars kpi-icon"></i>
                <a href="/Admin/Order/Index" class="small-box-footer text-white">More info â†’</a>
            </div>
        </div>
        @if (User.IsInRole(Helper.AdminRole))
        {
            <div class="col-lg-3 col-md-6">
                <div class="kpi-card bg-users">
                    <div>
                        <div class="kpi-value">@Model.TotalUsers</div>
                        <div class="kpi-label">Users</div>
                    </div>
                    <i class="ion ion-person kpi-icon"></i>
                    <a href="/Admin/Users/Index" class="small-box-footer text-white">More info â†’</a>
                </div>
            </div>
        }
    </div>
    @if(User.IsInRole(Helper.AdminRole)){
    <div class="row g-4 mt-2">
        @foreach (var stat in new[] {
                (Title: "Approved", Value: Model.ApprovedOrders, Color: "approved", Icon: "ion-checkmark text-success"),
                (Title: "Shipped", Value: Model.ShippedOrders, Color: "shipped", Icon: "ion-paper-airplane text-primary"),
                (Title: "Pending", Value: Model.PendingOrders, Color: "pending", Icon: "ion-alert-circled text-warning"),
                (Title: "Locked", Value: Model.UsersLockedAccount, Color: "locked", Icon: "ion-locked text-danger")
                })
        {
                var percent = (stat.Title == "Locked" ? Model.TotalUsers : Model.TotalOrders) > 0
            ? (stat.Value * 100.0 / (stat.Title == "Locked" ? Model.TotalUsers : Model.TotalOrders))
            : 0;

            <div class="col-lg-3 col-md-6">
                <div class="status-card">
                    <div class="status-header">
                        <div>
                            <div class="status-value">@stat.Value</div>
                            <div class="status-label">@stat.Title @(stat.Title == "Locked" ? "Accounts" : "Orders")</div>
                        </div>
                        <i class="ion @stat.Icon status-icon"></i>
                    </div>
                    <div class="progress">
                        <div class="progress-bar progress-@stat.Color" style="width:@percent%"></div>
                    </div>
                    <a href="@(stat.Title == "Locked" ? "/Admin/Users/Index" : "/Admin/Order/Index")" class="small-box-footer">More info â†’</a>
                </div>
            </div>
        }
    </div>
    }
    <div class="row g-4 mt-2">
        <div class="col-lg-4 col-md-6">
            <div class="info-card">
                <div>
                    <i class="ion ion-trophy text-warning info-icon"></i>
                    <div class="info-title">Best Selling Product</div>
                    <div class="info-value text-truncate">@(Model.MostPurchasedProduct?? "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø¬Ø§Øª")</div>
                </div>
                <a href="/Admin/Product/Index" class="small-box-footer">More info â†’</a>
            </div>
        </div>
        <div class="col-lg-4 col-md-6">
            <div class="info-card">
                <div>
                    <i class="ion ion-cube text-success info-icon"></i>
                    <div class="info-title">Most Available Product</div>
                    <div class="info-value text-truncate">@(Model.MostExistProduct?? "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª")</div>
                </div>
                <a href="/Admin/Product/Index" class="small-box-footer">More info â†’</a>
            </div>
        </div>
        @if(User.IsInRole(Helper.AdminRole)){
        <div class="col-lg-4 col-md-6">
            <div class="info-card">
                <div>
                    <i class="ion ion-person text-primary info-icon"></i>
                    <div class="info-title">Top Buyer</div>
                    <div class="info-value text-truncate">@(Model.MostPurchasedBuyer ?? "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø­Ø§Ù„ÙŠØ§")</div>
                </div>
                <a href="/Admin/Order/Index" class="small-box-footer">More info â†’</a>
            </div>
        </div>
        }
    </div>
</div>

<script>
    const toggleBtn = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const themeText = document.getElementById('themeText');
    const body = document.body;

    function updateBtn(isDark) {
        themeIcon.innerText = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
        themeText.innerText = isDark ? 'Light Mode' : 'Dark Mode';
    }

    if (localStorage.getItem('theme') === 'dark') {
        body.classList.add('dark-mode');
        updateBtn(true);
    }

    toggleBtn.addEventListener('click', () => {
        body.classList.toggle('dark-mode');
        const isDark = body.classList.contains('dark-mode');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        updateBtn(isDark);
    });
</script>